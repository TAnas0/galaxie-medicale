---
import { Icon } from "astro-icon/components";
import Logo from "./logo/Logo.astro";
---

<header
  class="w-full fixed top-0 z-50 shadow-md"
  data-aos="fade"
  data-aos-duration="100"
>
  <!-- Gradient Divider -->
  <div
    id="gradient-divider"
    class="hidden fixed top-0 w-full h-1 bg-gradient-to-r from-transparent via-indigo-900 to-primary opacity-50 z-40"
  ></div>

  <!-- Top Info Bar -->
  <div
    id="infobar"
    class="overflow-hidden bg-primary/95 text-primary-foreground backdrop-blur-sm shadow-md"
    data-aos="fade"
    data-aos-duration="300"
  >
    <div class="container mx-auto px-1 md:px-4 w-full text-xs sm:font-semibold">
      <div class="flex items-center justify-center lg:justify-between h-8">
        <div
          class="hidden lg:flex items-center !border border-white/90 py-1 px-2 gap-x-1 rounded-3xl space-x-2 text-gray-50"
        >
          <Icon name="heroicons:map-pin" class="text-lg" />
          <span>
            207, Boulevard de la Résistance, 7ᵉ étage, N°14 (C/O C.A.R), Casablanca, Maroc
          </span>
        </div>
        <div class="flex space-x-1 md:space-x-2 text-gray-50">
          <a
            href="tel:+212522456789"
            class="flex items-center hover:opacity-90 transition-opacity !border border-white/90 py-1 px-2 gap-x-1 rounded-3xl"
            aria-label="Appelez-nous au +212 5 22 45 67 89"
          >
            <Icon name="heroicons:phone" class="text-lg" />
            <span>+212 5 22 45 67 89</span>
          </a>
          <a
            href="mailto:contact@galaxiemedicale.ma"
            class="flex items-center hover:opacity-90 transition-opacity !border border-white/90 py-1 px-2 gap-x-1 rounded-3xl"
            aria-label="Email contact@galaxiemedicale.ma"
          >
            <Icon name="heroicons:envelope" class="text-lg" />
            <span class="pb-[2px]">contact@galaxiemedicale.ma</span>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Navigation -->
  <div
    id="navbar"
    class="bg-gray-50 transition-all duration-1000 ease-in-out text-gray-900 flex"
    data-aos="fade"
    data-aos-duration="300"
  >
    <div class="container mx-auto px-4">
      <div class="flex items-center space-x-12 h-16">
        <!-- Logo -->
        <div
          class="relative flex items-center !border-l border-dashed border-primary h-full px-3 bg-gray-50 shadow-sm"
        >
          <div class="absolute inset-y-0 right-0 !border-r border-primary"></div>
          <a href="/galaxie-medicale" class="flex">
            <Logo withText={true} variant="inline" />
          </a>
        </div>

        <!-- Desktop Nav -->
        <nav
          class="hidden lg:flex items-center space-x-8"
          role="navigation"
          aria-label="Navigation principale"
        >
          <a href="/galaxie-medicale" class="hover:underline text-lg">Accueil</a>
          <a href="/galaxie-medicale#categories" class="hover:underline text-lg">
            Nos Catégories
          </a>
          <a href="/galaxie-medicale/catalog" class="hover:underline text-lg">
            Notre Catalogue
          </a>
        </nav>

        <!-- Mobile Hamburger -->
        <div class="lg:hidden flex items-center absolute right-8">
          <button
            id="mobile-menu-button"
            class="p-3 hover:bg-accent rounded-lg transition-colors cursor-pointer"
            aria-label="Ouvrir le menu de navigation"
            aria-expanded="false"
          >
            <Icon name="heroicons:bars-4" class="min-w-6 min-h-6 stroke-[3] text-3xl" />
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="max-h-0 overflow-hidden opacity-0 transition-all duration-300 ease-in-out lg:hidden flex flex-col bg-gray-50 px-4 space-y-3 border-t border-gray-300"
  >
    <a href="/galaxie-medicale" class="block text-gray-900 hover:text-blue-600 mx-auto pt-3"
    >
      Accueil
    </a
    >
    <a
      href="/galaxie-medicale#categories"
      class="block text-gray-900 hover:text-blue-600 mx-auto"
    >
      Nos Catégories
    </a>
    <a
      href="/galaxie-medicale/catalog"
      class="block text-gray-900 hover:text-blue-600 mx-auto pb-3"
    >
      Notre Catalogue
    </a>
  </div>
</header>

<script is:browser>
  // Scroll behavior
  const infobar = document.getElementById("infobar");
  const navbar = document.getElementById("navbar");
  const gradientDivider = document.getElementById("gradient-divider");

  const hideInfobar = () => {
    infobar.animate(
      [
        { maxHeight: infobar.scrollHeight + "px", opacity: 1 },
        { maxHeight: "0px", opacity: 0 }
      ],
      { duration: 500, easing: "ease-in-out", fill: "forwards" }
    );
  };


  const showInfobar = () => {
    infobar.animate(
      [
        { maxHeight: "0px", opacity: 0 },
        { maxHeight: infobar.scrollHeight + "px", opacity: 1 }
      ],
      { duration: 500, easing: "ease-in-out", fill: "forwards" }
    );
  };

  const primary = getComputedStyle(document.documentElement).getPropertyValue('--color-primary').trim();
  const grayBg = getComputedStyle(document.documentElement).getPropertyValue('--color-gray-50').trim();
  const grayText = getComputedStyle(document.documentElement).getPropertyValue('--color-gray-900').trim();

  const showDarkNavbar = () => {
    navbar.animate(
      [
        { backgroundColor: grayBg, color: grayText }, // gray-50, gray-900
        { backgroundColor: primary, color: "white" }  // primary/95
      ],
      { duration: 500, easing: "ease-in-out", fill: "forwards" }
    );
  };

  const showLightNavbar = () => {
    navbar.animate(
      [
        { backgroundColor: primary, color: "white" },
        { backgroundColor: grayBg, color: grayText }
      ],
      { duration: 500, easing: "ease-in-out", fill: "forwards" }
    );
  };

  let infobarVisible = true;
  window.addEventListener("scroll", () => {
    const y = window.scrollY;

    if (y > 250 && infobarVisible) {
      hideInfobar();
      showDarkNavbar();
      gradientDivider.classList.remove("hidden")
      infobarVisible = false;
    } else if (y <= 250 && !infobarVisible) {
      showInfobar();
      showLightNavbar();
      gradientDivider.classList.add("hidden")
      infobarVisible = true;
    }
  });
  window.addEventListener("scroll", () => {
    console.log(window.scrollY)
    return
    const currentScrollY = window.scrollY;
    let infobarHidden = false
    if (currentScrollY > 250 && !infobarHidden) {
      hideInfobar()
      infobarHidden = true
    //   navbar.classList.add("bg-primary/95", "text-white");
    //   navbar.classList.remove("bg-gray-50", "text-gray-900");
    //   // gradientDivider.classList.remove("hidden");
    } else if (currentScrollY >= 250 && infobarHidden) {
      showInfobar()
      infobarHidden = false
    //   navbar.classList.remove("bg-primary/95", "text-white");
    //   navbar.classList.add("bg-gray-50", "text-gray-900");
    //   // gradientDivider.classList.add("hidden");
    }
  });

  // Mobile menu toggle
  const mobileBtn = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");

  const overlay = document.getElementById("mobile-menu-overlay");

  function openMenu() {
    mobileMenu.classList.remove("max-h-0", "opacity-0");
    mobileMenu.classList.add("max-h-96", "opacity-100");
    mobileBtn.setAttribute("aria-expanded", "true");
    overlay.classList.remove("opacity-0", "pointer-events-none");
    overlay.classList.add("opacity-100");
    document.addEventListener("click", outsideClickHandler);
  }

  function closeMenu() {
    mobileMenu.classList.add("max-h-0", "opacity-0");
    mobileMenu.classList.remove("max-h-96", "opacity-100");
    mobileBtn.setAttribute("aria-expanded", "false");
    overlay.classList.add("opacity-0", "pointer-events-none");
    overlay.classList.remove("opacity-100");
    document.removeEventListener("click", outsideClickHandler);
  }

  function outsideClickHandler(e) {
    if (!mobileMenu.contains(e.target) && !mobileBtn.contains(e.target)) {
      closeMenu();
    }
  }

  mobileBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    const expanded = mobileBtn.getAttribute("aria-expanded") === "true";
    expanded ? closeMenu() : openMenu();
  });

  // Close menu when a nav link is clicked
  const menuLinks = mobileMenu.querySelectorAll("a");
  menuLinks.forEach((link) => {
    link.addEventListener("click", () => {
      closeMenu();
    });
  });

</script>


<style>
#infobar {
  transition: max-height 0.6s ease, opacity 0.6s ease;
  overflow: hidden;
}
</style>